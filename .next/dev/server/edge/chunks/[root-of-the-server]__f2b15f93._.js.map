{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { createMiddlewareClient } from '@supabase/auth-helpers-nextjs';\r\nimport { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\nexport async function middleware(req: NextRequest) {\r\n    const res = NextResponse.next();\r\n    const supabase = createMiddlewareClient({ req, res });\r\n\r\n    const {\r\n        data: { session },\r\n    } = await supabase.auth.getSession();\r\n\r\n    // 1. Protected Admin Routes\r\n    if (req.nextUrl.pathname.startsWith('/admin')) {\r\n        if (!session) {\r\n            return NextResponse.redirect(new URL('/login', req.url));\r\n        }\r\n\r\n        // Fetch user role from metadata (or DB if needed, but metadata is faster for middleware)\r\n        // Note: For critical security, we should verify against DB, but metadata is good for first line of defense\r\n        // In our handle_new_user trigger, we can sync role to metadata if we want, \r\n        // but here we will query the profile table for maximum security.\r\n\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', session.user.id)\r\n            .single();\r\n\r\n        if (profile?.role !== 'admin') {\r\n            return NextResponse.redirect(new URL('/', req.url)); // Redirect unauthorized to home\r\n        }\r\n    }\r\n\r\n    // 2. Protected Staff Routes\r\n    if (req.nextUrl.pathname.startsWith('/booking') && req.nextUrl.pathname.includes('/staff')) {\r\n        if (!session) {\r\n            return NextResponse.redirect(new URL('/login', req.url));\r\n        }\r\n\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', session.user.id)\r\n            .single();\r\n\r\n        // Allow 'admin' to access staff routes too, or strictly 'staff'\r\n        if (profile?.role !== 'staff' && profile?.role !== 'admin') {\r\n            return NextResponse.redirect(new URL('/', req.url));\r\n        }\r\n    }\r\n\r\n    // 3. Protected User Routes (e.g. Profile, Bookings)\r\n    if (req.nextUrl.pathname.startsWith('/profile') || req.nextUrl.pathname.startsWith('/bookings')) {\r\n        if (!session) {\r\n            return NextResponse.redirect(new URL('/login', req.url));\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nexport const config = {\r\n    matcher: [\r\n        '/admin/:path*',\r\n        '/booking/:path*',\r\n        '/profile/:path*',\r\n        '/bookings/:path*',\r\n    ],\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;AACA;AAAA;;;AAGO,eAAe,WAAW,GAAgB;IAC7C,MAAM,MAAM,gMAAY,CAAC,IAAI;IAC7B,MAAM,WAAW,uBAAuB;QAAE;QAAK;IAAI;IAEnD,MAAM,EACF,MAAM,EAAE,OAAO,EAAE,EACpB,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAElC,4BAA4B;IAC5B,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW;QAC3C,IAAI,CAAC,SAAS;YACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1D;QAEA,yFAAyF;QACzF,2GAA2G;QAC3G,4EAA4E;QAC5E,iEAAiE;QAEjE,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;QAEX,IAAI,SAAS,SAAS,SAAS;YAC3B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,gCAAgC;QACzF;IACJ;IAEA,4BAA4B;IAC5B,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eAAe,IAAI,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW;QACxF,IAAI,CAAC,SAAS;YACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1D;QAEA,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;QAEX,gEAAgE;QAChE,IAAI,SAAS,SAAS,WAAW,SAAS,SAAS,SAAS;YACxD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACrD;IACJ;IAEA,oDAAoD;IACpD,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eAAe,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,cAAc;QAC7F,IAAI,CAAC,SAAS;YACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1D;IACJ;IAEA,OAAO;AACX;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;QACA;QACA;QACA;KACH;AACL"}}]
}